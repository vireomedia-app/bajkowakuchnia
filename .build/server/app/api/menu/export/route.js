"use strict";(()=>{var e={};e.id=1946,e.ids=[1946],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},40150:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>w,patchFetch:()=>y,requestAsyncStorage:()=>m,routeModule:()=>h,serverHooks:()=>x,staticGenerationAsyncStorage:()=>g});var r={};a.r(r),a.d(r,{GET:()=>c,dynamic:()=>d});var o=a(79182),i=a(72007),s=a(56719),n=a(93442),p=a(83178),u=a(12203);let d="force-dynamic";async function c(){try{let e=await p._.recipe.findMany({include:{ingredients:{include:{product:!0}}},orderBy:{name:"asc"}});if(!e||0===e.length)return n.NextResponse.json({error:"Brak receptur do eksportu"},{status:404});let t=u.P6.book_new(),a=[["Lp.","Nazwa receptury","Opis","Liczba porcji","Liczba składnik\xf3w","Kalorie (na 100g)","Białko (g)","Tłuszcz (g)","Węglowodany (g)"],...e.map((e,t)=>{let a=l(e);return[t+1,e?.name||"",e?.description||"",e?.servings||1,e?.ingredients?.length||0,a.calories.toFixed(1),a.protein.toFixed(1),a.fat.toFixed(1),a.carbohydrates.toFixed(1)]})],r=u.P6.aoa_to_sheet(a);for(let a of(r["!cols"]=[{width:5},{width:35},{width:40},{width:12},{width:15},{width:15},{width:12},{width:12},{width:15}],u.P6.book_append_sheet(t,r,"Podsumowanie receptur"),e))if(a?.id)try{let e=[];e.push(["RECEPTURA POSIŁKU"]),e.push(["Nazwa:",a?.name||""]),e.push(["Opis:",a?.description||""]),e.push(["Liczba porcji:",a?.servings||1]),e.push([]),e.push(["SKŁADNIKI"]),e.push(["Lp.","Nazwa składnika","Ilość","Jednostka"]),a.ingredients?.forEach((t,a)=>{e.push([a+1,t?.productName||"",t?.quantity||0,t?.unit||""])}),e.push([]),e.push([]);let r=l(a);e.push(["WARTOŚCI ODŻYWCZE (na 100g produktu gotowego)"]),e.push(["Kalorie:",`${r.calories.toFixed(1)} kcal`]),e.push(["Białko:",`${r.protein.toFixed(1)} g`]),e.push(["Tłuszcz:",`${r.fat.toFixed(1)} g`]),e.push(["  w tym kwasy tłuszczowe nasycone:",`${r.saturatedFat.toFixed(1)} g`]),e.push(["Węglowodany:",`${r.carbohydrates.toFixed(1)} g`]),e.push(["  w tym cukry:",`${r.sugars.toFixed(1)} g`]),e.push(["S\xf3l:",`${r.salt.toFixed(2)} g`]),e.push(["Wapń:",`${r.calcium.toFixed(1)} mg`]),e.push(["Żelazo:",`${r.iron.toFixed(1)} mg`]),e.push(["Witamina C:",`${r.vitaminC.toFixed(1)} mg`]),e.push([]),e.push([]),e.push(["SZCZEG\xd3ŁOWY ROZKŁAD WARTOŚCI ODŻYWCZYCH"]),e.push(["Składnik","Ilość (g/ml)","Kalorie","Białko (g)","Tłuszcz (g)","Węglowodany (g)"]),a.ingredients?.forEach(t=>{let a=t.product,r=t?.quantity||0;if(a){let o=r;"kg"===t.unit?o=1e3*r:"l"===t.unit&&(o=1e3*r);let i=o/100;e.push([t.productName||"",o.toFixed(1),((a.calories||0)*i).toFixed(1),((a.protein||0)*i).toFixed(1),((a.fat||0)*i).toFixed(1),((a.carbohydrates||0)*i).toFixed(1)])}else e.push([t.productName||"",r,"Brak danych","Brak danych","Brak danych","Brak danych"])});let o=u.P6.aoa_to_sheet(e);o["!cols"]=[{width:35},{width:25},{width:15},{width:15},{width:15},{width:15}];let i=(a?.name||"Receptura").replace(/[\/\\?*:[\]]/g,"").substring(0,31);u.P6.book_append_sheet(t,o,i)}catch(e){console.error(`Error processing recipe ${a.name}:`,e);continue}let o=u.cW(t,{type:"buffer",bookType:"xlsx"});return new n.NextResponse(o,{status:200,headers:{"Content-Type":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","Content-Disposition":`attachment; filename="receptury_jadlospis_${new Date().toISOString().split("T")[0]}.xlsx"`}})}catch(e){return console.error("Export error:",e),n.NextResponse.json({error:"Błąd podczas eksportu danych"},{status:500})}}function l(e){let t=0,a=0,r=0,o=0,i=0,s=0,n=0,p=0,u=0,d=0,c=0;e.ingredients?.forEach(e=>{let l=e.product;if(!l)return;let h=e?.quantity||0,m=h;"kg"===e.unit?m=1e3*h:"l"===e.unit&&(m=1e3*h),t+=m;let g=m/100;a+=(l.calories||0)*g,r+=(l.protein||0)*g,o+=(l.fat||0)*g,i+=(l.saturatedFat||0)*g,s+=(l.carbohydrates||0)*g,n+=(l.sugars||0)*g,p+=(l.salt||0)*g,u+=(l.calcium||0)*g,d+=(l.iron||0)*g,c+=(l.vitaminC||0)*g});let l=t>0?100/t:0;return{calories:a*l,protein:r*l,fat:o*l,saturatedFat:i*l,carbohydrates:s*l,sugars:n*l,salt:p*l,calcium:u*l,iron:d*l,vitaminC:c*l}}let h=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/menu/export/route",pathname:"/api/menu/export",filename:"route",bundlePath:"app/api/menu/export/route"},resolvedPagePath:"/home/ubuntu/kartoteka_magazynowa_app/nextjs_space/app/api/menu/export/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:m,staticGenerationAsyncStorage:g,serverHooks:x}=h,w="/api/menu/export/route";function y(){return(0,s.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:g})}},83178:(e,t,a)=>{a.d(t,{_:()=>o});var r=a(53524);let o=globalThis.prisma??new r.PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[4372,7609,2203],()=>a(40150));module.exports=r})();