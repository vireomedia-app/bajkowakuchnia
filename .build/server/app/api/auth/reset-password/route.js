"use strict";(()=>{var e={};e.id=9436,e.ids=[9436],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},43205:(e,s,t)=>{t.r(s),t.d(s,{originalPathname:()=>y,patchFetch:()=>g,requestAsyncStorage:()=>l,routeModule:()=>h,serverHooks:()=>x,staticGenerationAsyncStorage:()=>m});var a={};t.r(a),t.d(a,{POST:()=>w});var r=t(79182),o=t(72007),n=t(56719),i=t(93442),u=t(53524),p=t(3390),d=t.n(p);let c=new u.PrismaClient;async function w(e){try{let{token:s,newPassword:t}=await e.json();if(!s||!t)return i.NextResponse.json({success:!1,message:"Brak wymaganych danych"},{status:400});let a=await c.passwordResetToken.findUnique({where:{token:s},include:{user:!0}});if(!a)return i.NextResponse.json({success:!1,message:"Nieprawidłowy lub nieistniejący token"},{status:400});if(new Date>a.expiresAt)return i.NextResponse.json({success:!1,message:"Token wygasł. Poproś o nowy link do resetowania hasła."},{status:400});if(a.used)return i.NextResponse.json({success:!1,message:"Ten token został już użyty"},{status:400});let r=await d().hash(t,10);return await c.user.update({where:{id:a.userId},data:{password:r}}),await c.passwordResetToken.update({where:{id:a.id},data:{used:!0}}),i.NextResponse.json({success:!0,message:"Hasło zostało zmienione pomyślnie"})}catch(e){return console.error("Błąd resetowania hasła:",e),i.NextResponse.json({success:!1,message:"Wystąpił błąd podczas zmiany hasła"},{status:500})}finally{await c.$disconnect()}}let h=new r.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/auth/reset-password/route",pathname:"/api/auth/reset-password",filename:"route",bundlePath:"app/api/auth/reset-password/route"},resolvedPagePath:"/home/ubuntu/kartoteka_magazynowa_app/nextjs_space/app/api/auth/reset-password/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:l,staticGenerationAsyncStorage:m,serverHooks:x}=h,y="/api/auth/reset-password/route";function g(){return(0,n.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:m})}}};var s=require("../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),a=s.X(0,[4372,7609,3390],()=>t(43205));module.exports=a})();