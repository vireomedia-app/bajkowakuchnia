"use strict";(()=>{var e={};e.id=3898,e.ids=[3898],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},75114:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>m,patchFetch:()=>g,requestAsyncStorage:()=>w,routeModule:()=>l,serverHooks:()=>f,staticGenerationAsyncStorage:()=>y});var r={};a.r(r),a.d(r,{DELETE:()=>p,PATCH:()=>s});var i=a(79182),n=a(72007),o=a(56719),d=a(93442),c=a(83178),u=a(23381);async function s(e,{params:t}){try{let a=t.id,{name:r,unit:i,manufacturer:n,calories:o,salt:s,protein:p,fat:l,saturatedFat:w,carbohydrates:y,sugars:f,calcium:m,iron:g,vitaminC:h,allergens:_}=await e.json();if(!r||!i)return d.NextResponse.json({error:"Nazwa i jednostka miary są wymagane"},{status:400});await (0,u.id)("Przed edycją produktu"),await (0,u.aC)(50);let k=await c._.product.update({where:{id:a},data:{name:r,unit:i,manufacturer:n,calories:o,salt:s,protein:p,fat:l,saturatedFat:w,carbohydrates:y,sugars:f,calcium:m,iron:g,vitaminC:h,allergens:_||[]}});return d.NextResponse.json(k)}catch(e){return console.error("Error updating product:",e),d.NextResponse.json({error:"Nie udało się zaktualizować produktu"},{status:500})}}async function p(e,{params:t}){try{let e=t.id;return await (0,u.id)("Przed usunięciem produktu"),await (0,u.aC)(50),await c._.transaction.deleteMany({where:{productId:e}}),await c._.product.delete({where:{id:e}}),d.NextResponse.json({success:!0})}catch(e){return console.error("Error deleting product:",e),d.NextResponse.json({error:"Nie udało się usunąć produktu"},{status:500})}}let l=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/products/[id]/route",pathname:"/api/products/[id]",filename:"route",bundlePath:"app/api/products/[id]/route"},resolvedPagePath:"/home/ubuntu/kartoteka_magazynowa_app/nextjs_space/app/api/products/[id]/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:w,staticGenerationAsyncStorage:y,serverHooks:f}=l,m="/api/products/[id]/route";function g(){return(0,o.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:y})}},23381:(e,t,a)=>{a.d(t,{_H:()=>n,aC:()=>d,id:()=>i,pi:()=>o});var r=a(83178);async function i(e){try{let t=await r._.product.findMany({include:{transactions:!0}}),a=await r._.transaction.findMany(),i=await r._.recipe.findMany({include:{ingredients:!0}}),n=await r._.recipeIngredient.findMany(),o={products:t,transactions:a,recipes:i,recipeIngredients:n,timestamp:new Date().toISOString()};return await r._.backup.create({data:{data:JSON.stringify(o),description:e||"Automatyczny backup"}})}catch(e){throw console.error("Error creating backup:",e),e}}async function n(){try{return await r._.backup.findMany({orderBy:{createdAt:"desc"}})}catch(e){throw console.error("Error getting backups:",e),e}}async function o(e){try{let t=await r._.backup.findUnique({where:{id:e}});if(!t)throw Error("Backup not found");let a=JSON.parse(t.data);for(let e of(await r._.recipeIngredient.deleteMany(),await r._.recipe.deleteMany(),await r._.transaction.deleteMany(),await r._.product.deleteMany(),a.products))await r._.product.create({data:{id:e.id,name:e.name,unit:e.unit,currentStock:e.currentStock,manufacturer:e.manufacturer,calories:e.calories,protein:e.protein,fat:e.fat,saturatedFat:e.saturatedFat,carbohydrates:e.carbohydrates,sugars:e.sugars,salt:e.salt,calcium:e.calcium,iron:e.iron,vitaminC:e.vitaminC,createdAt:e.createdAt,updatedAt:e.updatedAt}});for(let e of a.transactions)await r._.transaction.create({data:{id:e.id,productId:e.productId,date:e.date,document:e.document,type:e.type,quantity:e.quantity,balance:e.balance,createdAt:e.createdAt}});if(a.recipes)for(let e of a.recipes)await r._.recipe.create({data:{id:e.id,name:e.name,description:e.description,servings:e.servings,createdAt:e.createdAt,updatedAt:e.updatedAt}});if(a.recipeIngredients)for(let e of a.recipeIngredients)await r._.recipeIngredient.create({data:{id:e.id,recipeId:e.recipeId,productId:e.productId,productName:e.productName,quantity:e.quantity,unit:e.unit}});return{success:!0}}catch(e){throw console.error("Error restoring backup:",e),e}}async function d(e=50){try{let t=await r._.backup.findMany({orderBy:{createdAt:"desc"},select:{id:!0}});if(t.length>e){let a=t.slice(e);await r._.backup.deleteMany({where:{id:{in:a.map(e=>e.id)}}})}}catch(e){throw console.error("Error cleaning up backups:",e),e}}},83178:(e,t,a)=>{a.d(t,{_:()=>i});var r=a(53524);let i=globalThis.prisma??new r.PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[4372,7609],()=>a(75114));module.exports=r})();